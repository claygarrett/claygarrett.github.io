<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Code, Art, and Nonsense"/><link rel="canonical" href="https://your-website-url.com/posts/first-post"/><meta name="twitter:url" content="https://your-website-url.com/posts/first-post"/><meta name="og:url" content="https://your-website-url.com/posts/first-post"/><title>Pushing Swift's tuple to theÂ limit | Code, Art, and Nonsense</title><meta name="twitter:title" content="Pushing Swift's tuple to theÂ limit | Code, Art, and Nonsense"/><meta name="og:title" content="Pushing Swift's tuple to theÂ limit | Code, Art, and Nonsense"/><meta name="description" content="Admit it. You've never been excited about the lowly tuple in Swift. Maybe it was there to comfort you when you're too lazy to write a struct. But face it. You friend-zoned the tuple a long time ago. Well, I'm here to suggest we give tuple a chance to get a little crazy. Let's make some bad coding decisions and regret it together!"/><meta name="twitter:description" content="Admit it. You've never been excited about the lowly tuple in Swift. Maybe it was there to comfort you when you're too lazy to write a struct. But face it. You friend-zoned the tuple a long time ago. Well, I'm here to suggest we give tuple a chance to get a little crazy. Let's make some bad coding decisions and regret it together!"/><meta name="og:description" content="Admit it. You've never been excited about the lowly tuple in Swift. Maybe it was there to comfort you when you're too lazy to write a struct. But face it. You friend-zoned the tuple a long time ago. Well, I'm here to suggest we give tuple a chance to get a little crazy. Let's make some bad coding decisions and regret it together!"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;300;500;900&display=swap" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Code, Art, and Nonsense"/></head><body class="item-page"><header><div class="wrapper"><a href="/" class="site-name">Code, Art, and Nonsense</a></div></header><div class="wrapper"><article><div class="content"><img src="/images/post-1/header.png "Tuple Trouble"" alt="alt text"/><h1>Pushing Swift's tuple to theÂ limit</h1><p>Admit it. You've never been excited about the lowly tuple in Swift. Maybe it was there to comfort you when you're too lazy to write a struct. But face it. You friend-zoned the tuple a long time ago. Well, I'm here to suggest we give tuple a chance to get a little crazy. Let's make some bad coding decisions and regret it together!</p><h1>A 3D Tuple with 1000 Things</h1><p>First, I'm gonna ground this exercise in a real world scenario: <em>versioning</em>. Sometimes we need to represent a software release version on our code, and that gives us a good example to explore a beautiful, bad idea. OK, so if we had our heads on straight, we'd probably just pick one of these:</p><pre><code><span class="keyword">let</span> version = <span class="string">"3.8.6"</span>
<span class="keyword">let</span> version = <span class="type">Version</span>(<span class="string">"3"</span>, <span class="string">"8"</span>, <span class="string">"6"</span>)
</code></pre><p>That'd be easy to code and understand. But want tuple to let its hair down and have some fun. So what if we could do this instead?</p><pre><code><span class="keyword">let</span> version = v.<span class="number">3.8.6</span>
</code></pre><h2>âœ… Pros</h2><ul><li>It's strongly typed so we couldn't accidentally throw a letter into our version string.</li><li>It'll confuse everyone and make them think we're smart. Think of all the friends we'll make! ğŸ•ºğŸ¼</li></ul><h2>ğŸ”´ Cons</h2><ul><li>We've gotta do all the freakin bullshit you're about to read.</li></ul><p>The good news, is this is possible in Swift! And the secret lies in creating a <strong><em>1000 element tuple</em></strong>. Let's take a look at this train wreck waiting to happen.</p><img src="https://i.imgflip.com/61esut.jpg "Trolley Problem: The top train track contains Boring Code while the bottom contains lots of exciting code"" alt="Alt"/><h1>ğŸ¦¶Getting our feetÂ dirty</h1><p>Yes, I mixed the metaphor. That's the least of your problems if you made it this far. Things are about to get weird. Let's go on a little adventure together and look at tuple basics. A simple 3-element tuple containing the first three letters of the English alphabet looks like this:</p><pre><code><span class="keyword">let</span> letters = (<span class="string">"A"</span>, <span class="string">"B"</span>, <span class="string">"C"</span>)
letters.<span class="number">0</span> <span class="comment">// A</span>
letters.<span class="number">1</span> <span class="comment">// B</span>
letters.<span class="number">2</span> <span class="comment">// C</span>
</code></pre><p>Nothing really groundbreaking or useful here. BUT! Hear me out. What if the elements in the tuple happened to be much more closely related to the index in which they appeared in the tuple.</p><pre><code><span class="keyword">let</span> numbers = (<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>)
numbers.<span class="number">0</span> <span class="comment">// 0</span>
numbers.<span class="number">1</span> <span class="comment">// 1</span>
numbers.<span class="number">2</span> <span class="comment">// 2</span>
</code></pre><p>The tuple's indices are now identical to the values they contain. You can now imagine doing useless stuff like <code>numbers.0 * numbers.1</code> which would result in <code>0</code>.</p><p><strong>"Oooooh,"</strong> you might say. <strong>"You managed to make multiplying two numbers painful!"</strong> Shut up, please. I'm trying to build a story here.</p><h1>ğŸ¤¯ Nested tuples can also be nested, numerical APIs</h1><p>What if we wanted to get more complicated and nest some tuples?</p><pre><code><span class="keyword">let</span> versionList = (
  (
    (<span class="string">"0.0.0"</span>, <span class="string">"0.0.1"</span>, <span class="string">"0.0.2"</span>),
    (<span class="string">"0.1.0"</span>, <span class="string">"0.1.1"</span>, <span class="string">"0.1.2"</span>),
    (<span class="string">"0.2.0"</span>, <span class="string">"0.2.1"</span>, <span class="string">"0.2.3"</span>)
  ),(
    (<span class="string">"1.0.0"</span>, <span class="string">"1.0.1"</span>, <span class="string">"1.0.2"</span>),
    (<span class="string">"1.1.0"</span>, <span class="string">"1.1.1"</span>, <span class="string">"1.1.2"</span>),
    (<span class="string">"1.2.0"</span>, <span class="string">"1.2.1"</span>, <span class="string">"1.2.3"</span>),
  ),(
    (<span class="string">"2.0.0"</span>, <span class="string">"2.0.1"</span>, <span class="string">"2.0.2"</span>),
    (<span class="string">"2.1.0"</span>, <span class="string">"2.1.1"</span>, <span class="string">"2.1.2"</span>),
    (<span class="string">"2.2.0"</span>, <span class="string">"2.2.1"</span>, <span class="string">"2.2.2"</span>)
  ),
)

<span class="call">print</span>(versionList.<span class="number">0.2.1</span>) <span class="comment">// "0.2.1"</span>
</code></pre><p>Pretty neat, huh? To state the obvious, this is overly complicated for the value it provides. It's a thought exercise, not a good idea. Also, an image always helps me get to where I'm going faster, so here's a clearer visualization of what that nested tuple looks like:</p><img src="/images/post-1/tuple.jpg "A 3D tuple visualized as a nested graph."" alt="alt text"/><h1>Defining a ğŸ”Ÿ x ğŸ”Ÿ x ğŸ”Ÿ tupleÂ type</h1><p>A 3 x 3 tuple like the one above gives us only 27 possible version numbers. But we need 1000 version numbers to support versions 0.0.0 through 9.9.9, assuming we don't ever want a component higher than 10. This is already a horrible assumption, so I hope you've lost all faith in me by now.</p><p>So, anyway, we need a 10 x 10 x 10 tuple. ğŸ¤¦ğŸ»â€â™‚ï¸ The even more terrible thing is we have to manually specify the shape of this tuple to the compiler. It needs to know that there's going to be a tuple that contains 10 tuples which each contain 10 more tuples that each that has a version number inside.</p><p><strong><em>I'm sorry I'm doing this to you. Bring me up in therapy if it helps.</em></strong></p><h2>Defining the innermost tuple</h2><p>Abstraction is sometimes our friend, so let's write a shortcut to reference the three different dimensions in our matrix of tuples. To actually represent each unique version in our tuple, we'll have an extremely simple Version class to hold the major/minor/revision version numbers. Our second typealias will reference the first one and the third typealias will reference the second one:</p><pre><code><span class="keyword">typealias</span> InnermostTuple = (
    <span class="type">Version</span>, <span class="type">Version</span>, <span class="type">Version</span>, <span class="type">Version</span>, <span class="type">Version</span>, 
    <span class="type">Version</span>, <span class="type">Version</span>, <span class="type">Version</span>, <span class="type">Version</span>, <span class="type">Version</span>
)
<span class="keyword">typealias</span> MiddleTuple = (
    <span class="type">InnermostTuple</span>, <span class="type">InnermostTuple</span>, <span class="type">InnermostTuple</span>, <span class="type">InnermostTuple</span>, <span class="type">InnermostTuple</span>, 
    <span class="type">InnermostTuple</span>, <span class="type">InnermostTuple</span>, <span class="type">InnermostTuple</span>, <span class="type">InnermostTuple</span>, <span class="type">InnermostTuple</span>
)
<span class="keyword">typealias</span> OutermostTuple = (
    <span class="type">MiddleTuple</span>, <span class="type">MiddleTuple</span>, <span class="type">MiddleTuple</span>, <span class="type">MiddleTuple</span>, <span class="type">MiddleTuple</span>, 
    <span class="type">MiddleTuple</span>, <span class="type">MiddleTuple</span>, <span class="type">MiddleTuple</span>, <span class="type">MiddleTuple</span>, <span class="type">MiddleTuple</span>
)
</code></pre><h2>Initializing such an unnecessarily largeÂ tuple</h2><p>We have the types we need, but how can we instantiate our mega-tuple? We can't programmatically access tuple elements via brackets like we can arrays. But there are ways to make this less verbose. Let's make a generator to create a fully populated instance of that type! ğŸ™„</p><p>What if there was a function that would place 10 things in a tuple for us, delegating the instantiation of those things to us, but giving our handler the index of the element that it plans to place it in. We'd also want it to be generic because each of the 3 layers of our nested tuple hold a different type.</p><pre><code><span class="comment">/// Given a transformation function that accepts an index, create a tuple of the 10 returned items, 
/// mapping the item to the same index in the tuple.</span>
<span class="keyword">static func</span> make10TupleIndexed&lt;T&gt;(transform t: (<span class="type">Int</span>) -&gt; <span class="type">T</span>) -&gt; (<span class="type">T</span>, <span class="type">T</span>, <span class="type">T</span>, <span class="type">T</span>, <span class="type">T</span>, <span class="type">T</span>, <span class="type">T</span>, <span class="type">T</span>, <span class="type">T</span>, <span class="type">T</span>) {
     <span class="keyword">return</span> (<span class="call">t</span>(<span class="number">0</span>), <span class="call">t</span>(<span class="number">1</span>), <span class="call">t</span>(<span class="number">2</span>), <span class="call">t</span>(<span class="number">3</span>), <span class="call">t</span>(<span class="number">4</span>), <span class="call">t</span>(<span class="number">5</span>), <span class="call">t</span>(<span class="number">6</span>), <span class="call">t</span>(<span class="number">7</span>), <span class="call">t</span>(<span class="number">8</span>), <span class="call">t</span>(<span class="number">9</span>))
  }
</code></pre><p>We're almost there! Now we just need to call our method once for each layer, passing in the appropriate <code>t</code> for each step. As we laid out above, the innermost steps' <code>t</code> should create Version instances, and needs the index of all 3 layers to do so, to guarantee a unique <code>Version</code>.</p><p>The middle layer's t should create a tuple of tuples, and the outer layer's t should create a tuple of tuple of tuples.</p><pre><code><span class="keyword">func</span> generate() -&gt; <span class="type">OutermostTuple</span> {
     <span class="call">make10TupleIndexed</span> { revisionIndex <span class="keyword">in</span>
         <span class="call">make10TupleIndexed</span> { minorIndex <span class="keyword">in</span>
             <span class="call">make10TupleIndexed</span> { majorIndex <span class="keyword">in</span>
                 <span class="type">Version</span>(majorIndex, minorIndex, revisionIndex)
             }
         }
     }
 }
</code></pre><h1>ğŸ˜ˆ Waking up our Frankenstein</h1><p>We're all done! Now we get to use our irresponsible creation irresponsibly!</p><pre><code><span class="keyword">let</span> v: <span class="type">OutermostTuple</span> = <span class="call">generate</span>()
<span class="type">VersionLogger</span>.<span class="call">log</span>(version: v.<span class="number">3.8.6</span>)
<span class="comment">// Logs "3.8.6"</span>
</code></pre><p>We now have an integer-based API that feels super clean and magical. But we made that magic in a rusty cauldron with the tears of kittens so let's not be <em>too</em> proud of ourselves.</p><img src="https://www.orlandosentinel.com/resizer/dHErRthtB24XuILPofXAKuBGeHc=/1200x0/top/cloudfront-us-east-1.images.arcpublishing.com/tronc/NGHCLEFQCFD3XCNNNYOHH64QZQ.jpg "Evil-looking Black Cauldron Character Dude"" alt="Alt"/><h1>Thanks</h1><p>I appreciate <a href="https://www.twitter.com/@bgannin">@bgannin</a> for inspiring this awful idea after I inspired his awful idea with my awful idea. Feel free to check out my post on the "tuple-alias" mentioned in this tweet.</p></div><span>Tagged with: </span><ul class="tag-list"><li><a href="/tags/first">first</a></li><li><a href="/tags/article">article</a></li></ul></article></div><footer><p>Generated using <a href="https://github.com/johnsundell/publish">Publish</a></p><p><a href="/feed.rss">RSS feed</a></p></footer></body></html>